# name: test/sql/oracle_secret_basic.test
# description: Test basic Oracle secret creation and management
# group: [sql]

require oracle

# Test 1: Create a basic Oracle secret with all parameters
statement ok
CREATE SECRET (
    TYPE oracle,
    HOST 'localhost',
    PORT 1521,
    SERVICE 'XEPDB1',
    USER 'test_user',
    PASSWORD 'test_pass'
);

# Test 2: Verify secret was created
query I
SELECT count(*) FROM duckdb_secrets() WHERE type = 'oracle' AND name = '__default_oracle';
----
1

# Test 3: Create a named Oracle secret
statement ok
CREATE SECRET ora_dev (
    TYPE oracle,
    HOST 'dev.example.com',
    PORT 1521,
    SERVICE 'DEVDB',
    USER 'dev_user',
    PASSWORD 'dev_password'
);

# Test 4: Verify named secret was created
query I
SELECT count(*) FROM duckdb_secrets() WHERE type = 'oracle' AND name = 'ora_dev';
----
1

# Test 5: Test DATABASE alias instead of SERVICE
statement ok
CREATE SECRET ora_test (
    TYPE oracle,
    HOST 'test.example.com',
    PORT 1521,
    DATABASE 'TESTDB',
    USER 'test_user',
    PASSWORD 'test_password'
);

# Test 6: Verify DATABASE alias works (should have service='TESTDB')
query I
SELECT count(*) FROM duckdb_secrets() WHERE type = 'oracle' AND name = 'ora_test';
----
1

# Test 7: Verify passwords are redacted in output
query I
SELECT count(*) FROM duckdb_secrets() WHERE type = 'oracle' AND secret_string LIKE '%password=redacted%';
----
3

# Test 8: Test default values (minimal secret)
statement ok
CREATE SECRET ora_minimal (
    TYPE oracle,
    SERVICE 'MINDB',
    USER 'minuser',
    PASSWORD 'minpass'
);

# Test 9: Verify default values applied (host should be localhost, port 1521)
query I
SELECT count(*) FROM duckdb_secrets() WHERE type = 'oracle' AND name = 'ora_minimal' AND secret_string LIKE '%host=localhost%';
----
1
