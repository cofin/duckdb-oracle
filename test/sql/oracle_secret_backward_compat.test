# name: test/sql/oracle_secret_backward_compat.test
# description: Test backward compatibility with existing Oracle extension functionality
# group: [oracle]

require oracle

# Note: These tests verify that existing functionality still works
# They will fail to connect (no Oracle server), but should show proper error messages

# Test 1: Traditional connection string ATTACH still works
statement error
ATTACH 'user/password@oldhost:1521/OLDDB' AS old_db (TYPE oracle);
----
Cannot connect to database

# Test 2: Wallet function validates path exists
statement error
SELECT oracle_attach_wallet('/nonexistent/wallet');
----
Wallet path does not exist

# Test 3: Clear cache function still works
statement ok
SELECT oracle_clear_cache();

# Test 4: Can create secret and still use connection string ATTACH (secret should be ignored)
statement ok
CREATE SECRET test_compat (
    TYPE oracle,
    HOST 'secret.example.com',
    PORT 1521,
    SERVICE 'SECRETDB',
    USER 'secret_user',
    PASSWORD 'secret_pass'
);

# Test 5: Connection string takes precedence over secret
statement error
ATTACH 'direct/pass@direct.host:1521/DIRECTDB' AS direct_db (TYPE oracle);
----
Cannot connect to database
